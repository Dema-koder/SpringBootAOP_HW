# Документация: Реализация логирования с использованием Spring AOP

## Введение

В данном проекте мы реализовали логирование операций в сервисах, связанных с управлением пользователями и их заказами, используя технологию Aspect-Oriented Programming (AOP) в Spring. AOP позволяет отделить аспекты, такие как логирование, от основной бизнес-логики, что улучшает читаемость и сопровождение кода.

## Подход к реализации

1. **Создание аспекта**:
    - Мы создали класс `LoggingAspect`, пометив его аннотацией `@Aspect` и `@Component`, чтобы сделать его аспектом и зарегистрировать в контексте Spring.
    - В классе был определен `Pointcut`, который охватывает все методы сервисов `UserService` и `OrderService`.
    - Использованы следующие советы AOP:
        - `@Around`: Для логирования начала и конца выполнения метода, а также замера времени его выполнения.
        
2. **Логирование параметров и результатов**:
    - Логирование параметров метода осуществляется путем извлечения аргументов метода через `ProceedingJoinPoint`.
    - Результат метода логируется после успешного завершения вызова метода.

3. **Логирование исключений**:
    - В случае возникновения исключений, они перехватываются и логируются с указанием типа и сообщения об ошибке.

4. **Настройка логирования**:
    - Для управления логированием используется `Logback` (дефолтная реализация в Spring Boot).
    - Логи настраиваются через конфигурационный файл `logback.xml`, где указаны уровни логирования и аппендеры.

## Отчет

### Описание проекта

Проект представляет собой Spring Boot приложение, состоящее из двух основных сервисов: `UserService` и `OrderService`. Каждый сервис предоставляет CRUD операции для управления пользователями и заказами. Для логирования всех операций в этих сервисах используется Spring AOP.

### Инструкции по запуску

1. **Склонируйте репозиторий**:
   ```bash
   git clone <URL-репозитория>
   cd <название-проекта>
   ```
2. **Сборка и запуск**:
    Проект собирается и запускается с использованием Maven или Gradle:
    ```bash
    ./mvnw spring-boot:run
   ```
3. **Конфигурация БД**:
   Убедитесь, что в application.properties настроены правильные параметры подключения к базе данных.
4. **Тестирование**:
   Для запуска тестов используйте команду:
    ```bash
    ./mvnw test
   ```

### Примеры логов
Примеры логов при вызове метода создания пользователя:
```text
INFO  - Выполнение метода createUser с аргументами [{null Ivan ivan@gmail.com}]
INFO  - Метод createUser выполнился за 2 мс с результатом {2 Ivan ivan@gmail.com}
```

### Примеры тестов
Пример теста для метода getAllUsers:
```java
@Test
@DisplayName("Check logs around getAllUsers")
void testLoggingGetAllUsers() {
    var list = userService.getAllUsers();

    assertThat(listAppender.list)
       .extracting(ILoggingEvent::getFormattedMessage)
          .anyMatch(message ->
               message.contains("Выполнение метода getAllUsers с аргументами []"))
          .anyMatch(message ->
               message.contains("Метод getAllUsers выполнился за") &&
                   message.contains("с результатом " + list.toString()));
}
```

## Заключение

Данная реализация логирования с использованием Spring AOP позволяет эффективно отделить аспекты логирования от бизнес-логики, обеспечивая централизованное управление логами. Это не только упрощает отладку и сопровождение, но и улучшает модульность приложения.